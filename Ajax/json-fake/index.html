<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Fake</title>
    <style>
        #showError{
            background-color: beige;
            width: 300px;
            aspect-ratio: 1;
            position: relative;
        }
        #close-btn{
            background-color: red;
            position: absolute;
            top: 280px;
            color: white;
            padding: 10px 15px;
        }
    </style>
</head>
<body>
    <dialog id="showError">Erro:
        <p id="error-msg"></p>
        <button id="close-btn">Fechar</button>
    </dialog>
    <form>
        <input type="text" name="title" id="title"><br>
        <textarea name="body" id="body"></textarea>
        <input type="submit" value="Cadastrar" id="btnCadastrar">
    </form>
    <script>
        document.querySelector("form").addEventListener("submit", function(e){
            e.preventDefault()
            cadastrarPost(4)
        })
        function mostrarDados(dados){
            console.log(dados)
        }
        async function buscarPostPorUsuario(id){
            try{
                const resp = await fetch(`https://jsonplaceholder.typicode.com/users/${id}/posts`)

                if(!resp.ok){
                    throw Error("Erro na requisição")
                }
                

                const dados = await resp.json()
                mostrarDados(dados)
            }catch(e){
                document.getElementById("showError").showModal()
                document.getElementById("error-msg").textContent = e
            }
        }
        document.getElementById("close-btn").addEventListener("click", () => document.getElementById("showError").close())
        buscarPostPorUsuario(2)

        async function cadastrarPost(userId){
            try{
                const resp = await fetch('https://jsonplaceholder.typicode.com/posts', {
                method: 'POST',
                body: JSON.stringify({
                    title: document.getElementById("title").value,
                    body: document.getElementById("body").value,
                    userId
                }),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                },
                })

                console.log(resp)
                console.log(resp.status)
                const dados = await resp.json()
                mostrarDados(dados)
            }catch(e){
                alert("Erro: "+  e)
            }
        }
    </script>
</body>
</html>